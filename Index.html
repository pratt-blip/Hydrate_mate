<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>8-Week Hydration Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect } = React;

const HydrationTracker = () => {
  const startDate = new Date('2026-01-30');
  const [currentDate] = useState(new Date());
  
  const [allDaysData, setAllDaysData] = useState(() => {
    const saved = localStorage.getItem('hydrationData');
    return saved ? JSON.parse(saved) : {};
  });
  
  const todayKey = currentDate.toISOString().split('T')[0];
  const [todayData, setTodayData] = useState(() => {
    return allDaysData[todayKey] || {
      waterIntake: 0,
      bathroomTrips: 0,
      nighttimeTrips: 0,
      ansCharge: null,
      lastDrink: null,
      lastBathroom: null
    };
  });
  
  const [reminderEnabled, setReminderEnabled] = useState(() => {
    return localStorage.getItem('reminderEnabled') !== 'false';
  });
  
  const [customAmounts, setCustomAmounts] = useState(() => {
    const saved = localStorage.getItem('customAmounts');
    return saved ? JSON.parse(saved) : [200, 300, 500, 750];
  });
  
  const [showGraphs, setShowGraphs] = useState(false);
  const [showCustomize, setShowCustomize] = useState(false);
  const [showAnsInput, setShowAnsInput] = useState(false);
  const [tempAns, setTempAns] = useState('');

  const quotes = {
    1: "You're correcting years of deficit. Every trip is healing! ðŸ’ª",
    2: "You're halfway through the toughest phase! ðŸŽ¯",
    3: "You're improving! Can you feel the difference? ðŸ“ˆ",
    4: "The transition is nearly complete! ðŸŽ‰",
    5: "Adaptation is happening! Fewer trips now? ðŸŽŠ",
    6: "This is your new sustainable normal! âœ¨",
    7: "You did it! This is permanent now! ðŸŒŸ",
    8: "Elite status achieved! 8 weeks complete! ðŸ‘‘"
  };

  const PlusIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
  const DropletIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>;
  const ClockIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
  const BarChartIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>;
  const DownloadIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>;
  const TrashIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
  const EditIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
  const HeartIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>;

  useEffect(() => {
    const updatedData = { ...allDaysData, [todayKey]: todayData };
    setAllDaysData(updatedData);
    localStorage.setItem('hydrationData', JSON.stringify(updatedData));
  }, [todayData, todayKey, allDaysData]);

  useEffect(() => {
    localStorage.setItem('reminderEnabled', reminderEnabled.toString());
  }, [reminderEnabled]);

  useEffect(() => {
    localStorage.setItem('customAmounts', JSON.stringify(customAmounts));
  }, [customAmounts]);

  const daysSinceStart = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
  const currentWeek = Math.min(Math.floor(daysSinceStart / 7) + 1, 8);

  const expectedTrips = { 1: "12-15+", 2: "10-14", 3: "8-12", 4: "7-10", 5: "6-8", 6: "6-8", 7: "6-7", 8: "6-7" };

  const getWeeklyData = () => {
    const weeks = Array(8).fill(null).map((_, i) => ({ week: i + 1, days: [], avgIntake: 0, avgTrips: 0, avgNighttime: 0, avgAns: null }));
    Object.keys(allDaysData).forEach(dateKey => {
      const date = new Date(dateKey);
      const daysSince = Math.floor((date - startDate) / (1000 * 60 * 60 * 24));
      const weekIndex = Math.floor(daysSince / 7);
      if (weekIndex >= 0 && weekIndex < 8) weeks[weekIndex].days.push(allDaysData[dateKey]);
    });
    weeks.forEach(week => {
      if (week.days.length > 0) {
        week.avgIntake = week.days.reduce((sum, d) => sum + d.waterIntake, 0) / week.days.length;
        week.avgTrips = week.days.reduce((sum, d) => sum + d.bathroomTrips, 0) / week.days.length;
        week.avgNighttime = week.days.reduce((sum, d) => sum + (d.nighttimeTrips || 0), 0) / week.days.length;
        const ansValues = week.days.filter(d => d.ansCharge != null).map(d => d.ansCharge);
        if (ansValues.length > 0) week.avgAns = ansValues.reduce((sum, v) => sum + v, 0) / ansValues.length;
      }
    });
    return weeks;
  };

  const getLast14Days = () => {
    const days = [];
    for (let i = 13; i >= 0; i--) {
      const date = new Date(currentDate);
      date.setDate(date.getDate() - i);
      const key = date.toISOString().split('T')[0];
      const data = allDaysData[key];
      days.push({
        date: date.toLocaleDateString('en-AU', { month: 'short', day: 'numeric' }),
        intake: data?.waterIntake || 0,
        trips: data?.bathroomTrips || 0,
        nighttime: data?.nighttimeTrips || 0,
        ans: data?.ansCharge
      });
    }
    return days;
  };

  const addWater = (amount) => {
    setTodayData(prev => ({ ...prev, waterIntake: prev.waterIntake + amount, lastDrink: new Date().toISOString() }));
  };

  const addBathroomTrip = (isNighttime = false) => {
    setTodayData(prev => ({
      ...prev,
      bathroomTrips: prev.bathroomTrips + 1,
      nighttimeTrips: isNighttime ? (prev.nighttimeTrips || 0) + 1 : (prev.nighttimeTrips || 0),
      lastBathroom: new Date().toISOString()
    }));
  };

  const saveAns = () => {
    const value = parseFloat(tempAns);
    if (!isNaN(value) && value >= -10 && value <= 10) {
      setTodayData(prev => ({ ...prev, ansCharge: value }));
      setShowAnsInput(false);
      setTempAns('');
    }
  };

  const formatTime = (dateString) => {
    if (!dateString) return 'Never';
    return new Date(dateString).toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit' });
  };

  const exportData = () => {
    const csv = [
      ['Date', 'Water (ml)', 'Bathroom Trips', 'Nighttime', 'ANS', 'Week'],
      ...Object.entries(allDaysData).map(([date, data]) => {
        const d = new Date(date);
        const week = Math.floor((d - startDate) / (1000 * 60 * 60 * 24) / 7) + 1;
        return [date, data.waterIntake, data.bathroomTrips, data.nighttimeTrips || 0, data.ansCharge ?? '', week];
      })
    ].map(row => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `hydration-${todayKey}.csv`;
    a.click();
  };

  const weeklyData = getWeeklyData();
  const last14Days = getLast14Days();

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-4">
      <div className="max-w-2xl mx-auto space-y-4">
        
        <div className="bg-white rounded-lg shadow-lg p-6">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">8-Week Hydration Tracker</h1>
          <div className="text-sm text-gray-600 mb-4">Day {daysSinceStart + 1} â€¢ Week {currentWeek}</div>
          
          <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg p-3 mb-4">
            <p className="text-purple-800 font-semibold text-center text-sm italic">"{quotes[currentWeek]}"</p>
          </div>
          
          <div className="grid grid-cols-2 gap-2">
            <button onClick={() => setShowGraphs(!showGraphs)} className="bg-purple-600 hover:bg-purple-700 text-white rounded-lg px-3 py-2 text-sm font-semibold flex items-center justify-center gap-2">
              <BarChartIcon /> {showGraphs ? 'Hide' : 'Show'} Graphs
            </button>
            <button onClick={() => setShowCustomize(!showCustomize)} className="bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-3 py-2 text-sm font-semibold flex items-center justify-center gap-2">
              <EditIcon /> Customize
            </button>
            <button onClick={exportData} className="bg-green-600 hover:bg-green-700 text-white rounded-lg px-3 py-2 text-sm font-semibold flex items-center justify-center gap-2">
              <DownloadIcon /> Export
            </button>
            <button onClick={() => { if(confirm('Delete all data?')) { localStorage.clear(); window.location.reload(); }}} className="bg-red-600 hover:bg-red-700 text-white rounded-lg px-3 py-2 text-sm font-semibold flex items-center justify-center gap-2">
              <TrashIcon /> Clear
            </button>
          </div>
        </div>

        {showCustomize && (
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-lg font-bold mb-3">Customize Buttons</h2>
            <div className="grid grid-cols-4 gap-2">
              {customAmounts.map((amount, i) => (
                <input key={i} type="number" value={amount} onChange={(e) => {
                  const newAmounts = [...customAmounts];
                  newAmounts[i] = parseInt(e.target.value) || 0;
                  setCustomAmounts(newAmounts);
                }} className="border rounded px-2 py-1 text-sm" />
              ))}
            </div>
          </div>
        )}

        <div className="bg-white rounded-lg shadow-lg p-6">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-2">
              <HeartIcon />
              <h3 className="font-semibold">Morning ANS</h3>
            </div>
            {todayData.ansCharge !== null ? (
              <div className="flex items-center gap-2">
                <span className={`text-2xl font-bold ${todayData.ansCharge >= 3 ? 'text-green-600' : todayData.ansCharge >= 0 ? 'text-yellow-600' : 'text-red-600'}`}>
                  {todayData.ansCharge > 0 ? '+' : ''}{todayData.ansCharge.toFixed(1)}
                </span>
                <button onClick={() => { setTempAns(todayData.ansCharge.toString()); setShowAnsInput(true); }} className="text-blue-600">
                  <EditIcon />
                </button>
              </div>
            ) : (
              <button onClick={() => setShowAnsInput(true)} className="bg-red-600 hover:bg-red-700 text-white rounded px-4 py-2 text-sm font-semibold">Add ANS</button>
            )}
          </div>
          {showAnsInput && (
            <div className="bg-gray-50 rounded p-3 space-y-2">
              <input type="number" value={tempAns} onChange={(e) => setTempAns(e.target.value)} placeholder="-10 to +10" step="0.1" className="w-full border rounded px-3 py-2" />
              <div className="flex gap-2">
                <button onClick={saveAns} className="flex-1 bg-green-600 text-white rounded px-3 py-2 font-semibold">Save</button>
                <button onClick={() => { setShowAnsInput(false); setTempAns(''); }} className="flex-1 bg-gray-400 text-white rounded px-3 py-2 font-semibold">Cancel</button>
              </div>
            </div>
          )}
        </div>

        <div className="bg-white rounded-lg shadow-lg p-6">
          <h2 className="text-xl font-bold mb-4">Today's Progress</h2>
          <div className="mb-4">
            <div className="flex justify-between mb-2">
              <span className="text-sm font-semibold">Water Intake</span>
              <span className="text-2xl font-bold text-blue-600">{(todayData.waterIntake / 1000).toFixed(1)}L</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-4">
              <div className={`h-4 rounded-full transition-all ${todayData.waterIntake >= 2500 ? 'bg-green-600' : todayData.waterIntake >= 2000 ? 'bg-yellow-600' : 'bg-blue-600'}`} style={{ width: `${Math.min((todayData.waterIntake / 2500) * 100, 100)}%` }} />
            </div>
          </div>

          <div className="grid grid-cols-4 gap-2 mb-4">
            {customAmounts.map((amount, i) => (
              <button key={i} onClick={() => addWater(amount)} className="bg-blue-500 hover:bg-blue-600 text-white rounded p-3 text-sm font-semibold">+{amount}ml</button>
            ))}
          </div>

          <div className="space-y-3">
            <div className="bg-amber-50 border border-amber-200 rounded p-3">
              <div className="flex justify-between mb-2">
                <span className="text-sm font-semibold">Daytime Trips</span>
                <span className="text-2xl font-bold text-amber-600">{todayData.bathroomTrips - (todayData.nighttimeTrips || 0)}</span>
              </div>
              <button onClick={() => addBathroomTrip(false)} className="w-full bg-amber-500 hover:bg-amber-600 text-white rounded p-2 font-semibold flex items-center justify-center gap-2">
                <PlusIcon /> Log Daytime
              </button>
            </div>
            <div className="bg-indigo-50 border border-indigo-200 rounded p-3">
              <div className="flex justify-between mb-2">
                <span className="text-sm font-semibold">Nighttime Trips</span>
                <span className="text-2xl font-bold text-indigo-600">{todayData.nighttimeTrips || 0}</span>
              </div>
              <button onClick={() => addBathroomTrip(true)} className="w-full bg-indigo-500 hover:bg-indigo-600 text-white rounded p-2 font-semibold flex items-center justify-center gap-2">
                <PlusIcon /> Log Nighttime
              </button>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-2 mt-3 text-sm">
            <div className="bg-blue-50 rounded p-2">
              <p className="text-gray-600">Last drink:</p>
              <p className="font-semibold text-blue-700">{formatTime(todayData.lastDrink)}</p>
            </div>
            <div className="bg-amber-50 rounded p-2">
              <p className="text-gray-600">Last bathroom:</p>
              <p className="font-semibold text-amber-700">{formatTime(todayData.lastBathroom)}</p>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <ClockIcon />
              <div>
                <h3 className="font-semibold text-sm">2-Hour Reminders</h3>
                <p className="text-xs text-gray-600">08:00-18:00</p>
              </div>
            </div>
            <button onClick={() => setReminderEnabled(!reminderEnabled)} className={`px-4 py-2 rounded font-semibold text-sm ${reminderEnabled ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-600'}`}>
              {reminderEnabled ? 'ON' : 'OFF'}
            </button>
          </div>
        </div>

        {showGraphs && (
          <>
            <div className="bg-white rounded-lg shadow-lg p-6">
              <h2 className="text-lg font-bold mb-4">Weekly Averages</h2>
              {weeklyData.map(week => (
                <div key={week.week} className={`border rounded p-3 mb-2 ${week.week === currentWeek ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}`}>
                  <div className="flex justify-between items-center mb-2">
                    <span className="font-bold">Week {week.week}</span>
                    <span className="text-xs text-gray-600">{week.days.length} days</span>
                  </div>
                  {week.days.length > 0 && (
                    <div className="grid grid-cols-4 gap-2 text-xs">
                      <div><p className="text-gray-600">Intake</p><p className="font-bold text-blue-600">{(week.avgIntake / 1000).toFixed(1)}L</p></div>
                      <div><p className="text-gray-600">Trips</p><p className="font-bold text-amber-600">{week.avgTrips.toFixed(1)}</p></div>
                      <div><p className="text-gray-600">Night</p><p className="font-bold text-red-600">{week.avgNighttime.toFixed(1)}</p></div>
                      <div><p className="text-gray-600">ANS</p><p className={`font-bold ${week.avgAns >= 3 ? 'text-green-600' : week.avgAns >= 0 ? 'text-yellow-600' : 'text-red-600'}`}>{week.avgAns !== null ? week.avgAns.toFixed(1) : '-'}</p></div>
                    </div>
                  )}
                </div>
              ))}
            </div>

            <div className="bg-white rounded-lg shadow-lg p-6">
              <h2 className="text-lg font-bold mb-4">Last 14 Days</h2>
              <div className="h-32 flex items-end justify-between gap-1 mb-6">
                {last14Days.map((day, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-gray-100 rounded-t relative" style={{ height: '100px' }}>
                      <div className="absolute bottom-0 w-full bg-blue-500 rounded-t" style={{ height: `${(day.intake / 3000) * 100}%` }} title={`${(day.intake / 1000).toFixed(1)}L`} />
                      <div className="absolute w-full border-t-2 border-dashed border-green-500" style={{ bottom: '83%' }} />
                    </div>
                    <span className="text-[8px] text-gray-600 mt-1">{day.date.split(' ')[1]}</span>
                  </div>
                ))}
              </div>
              <div className="h-32 flex items-end justify-between gap-1">
                {last14Days.map((day, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-gray-100 rounded-t relative" style={{ height: '100px' }}>
                      <div className="absolute bottom-0 w-full bg-amber-500 rounded-t" style={{ height: `${(day.trips / 20) * 100}%` }} title={`${day.trips} trips`} />
                      {day.nighttime > 0 && <div className="absolute bottom-0 w-full bg-red-500 rounded-t z-10" style={{ height: `${(day.nighttime / 20) * 100}%` }} />}
                    </div>
                    <span className="text-[8px] text-gray-600 mt-1">{day.date.split(' ')[1]}</span>
                  </div>
                ))}
              </div>
            </div>
          </>
        )}

        <div className="bg-gray-100 rounded p-3 text-center text-xs text-gray-600">
          <p>Expected trips Week {currentWeek}: {expectedTrips[currentWeek]}</p>
          <p className="mt-1">Target: 0-1 nighttime trips â€¢ 2.5L+ water daily</p>
        </div>
      </div>
    </div>
  );
};

ReactDOM.render(<HydrationTracker />, document.getElementById('root'));
</script>
</body>
</html>
